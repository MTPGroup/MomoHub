---
title: 聊天会话
description: 聊天会话和消息 API
navigation:
  icon: i-lucide-message-circle
---

## 创建会话

::endpoint{method="POST" path="/chats" auth}
创建一个新的私聊会话，需要指定对话的角色 ID。
::

**请求参数：**

::field{name="characterId" type="string" required}
关联的角色 ID（UUID 格式）
::

::field{name="name" type="string"}
聊天会话名称
::

**响应数据：**

```json
{
  "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
  "name": "与白洲梓的对话",
  "lastMessage": null,
  "characterId": "967217c8-4e26-4404-bcc4-03e084b5d6f9",
  "createdAt": "2026-01-15T08:30:00Z",
  "updatedAt": "2026-01-15T08:30:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 201 | 创建成功 |
| 400 | 输入参数无效 |
| 401 | 未登录或令牌无效 |

---

## 获取会话列表

::endpoint{method="GET" path="/chats" auth}
获取当前用户的所有会话，支持分页。
::

**查询参数：**

::field{name="page" type="string"}
页码，从 1 开始
::

::field{name="limit" type="string"}
每页数量，1-100
::

**响应数据：**

```json
{
  "items": [
    {
      "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
      "name": "与白洲梓的对话",
      "lastMessage": "Vanitas Vanitatum Et Omnia Vanitas。",
      "characterId": "967217c8-4e26-4404-bcc4-03e084b5d6f9",
      "createdAt": "2026-01-15T08:30:00Z",
      "updatedAt": "2026-01-15T09:00:00Z"
    }
  ],
  "total": 8,
  "page": 1,
  "limit": 20,
  "totalPages": 1,
  "hasNext": false,
  "hasPrevious": false
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |

---

## 获取会话详情

::endpoint{method="GET" path="/chats/{chatId}" auth}
获取指定会话的详细信息，需要是会话的所有者。
::

**响应数据：**

```json
{
  "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
  "name": "与白洲梓的对话",
  "lastMessage": "Vanitas Vanitatum Et Omnia Vanitas。",
  "characterId": "967217c8-4e26-4404-bcc4-03e084b5d6f9",
  "createdAt": "2026-01-15T08:30:00Z",
  "updatedAt": "2026-01-15T09:00:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 更新会话名称

::endpoint{method="PUT" path="/chats/{chatId}/name" auth}
更新指定会话的名称，需要是会话的所有者。
::

**请求参数：**

::field{name="name" type="string"}
新的会话名称
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 更新成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 删除会话

::endpoint{method="DELETE" path="/chats/{chatId}" auth}
永久删除指定会话及其所有消息、配置和插件订阅，需要是会话的所有者。
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 204 | 删除成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 发送消息（SSE 流式响应）

::endpoint{method="POST" path="/chats/{chatId}/messages" auth}
向指定会话发送消息并获取 AI 回复，响应为 SSE (Server-Sent Events) 流式格式。
::

**请求参数：**

::field{name="content" type="MessageContentDto[]" required}
消息内容数组，支持多模态（文本、图片、文件、代码、音频、视频、PDF）
::

**消息内容类型：**

| 类型 | 字段 | 说明 |
| --- | --- | --- |
| `text` | `content` | 文本内容 |
| `image` | `url`, `alt` | 图片地址和描述 |
| `file` | `fileName`, `fileSize`, `mimeType` | 文件信息 |
| `code` | `content`, `language` | 代码内容和语言 |

**请求示例：**

```json
{
  "content": [
    {
      "type": "text",
      "content": "白洲梓，你好"
    }
  ]
}
```

**SSE 事件类型：**

| 事件 | 说明 |
| --- | --- |
| `delta` | 增量文本 |
| `tool_call_start` | 工具调用开始 |
| `tool_call_result` | 工具调用结果 |
| `done` | 完成 |
| `error` | 错误 |

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | SSE 流式响应 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 获取历史消息

::endpoint{method="GET" path="/chats/{chatId}/messages" auth}
获取指定会话的历史消息，支持分页，需要是会话的所有者。
::

**查询参数：**

::field{name="page" type="string"}
页码，从 1 开始
::

::field{name="limit" type="string"}
每页数量，1-100
::

**响应数据：**

```json
{
  "items": [
    {
      "id": "c3d4e5f6-a7b8-9012-cdef-123456789012",
      "senderType": "USER",
      "content": [
        {
          "type": "text",
          "content": "白洲梓，你好"
        }
      ],
      "createdAt": "2026-01-15T08:31:00Z"
    },
    {
      "id": "d4e5f6a7-b8c9-0123-def0-234567890123",
      "senderType": "ASSISTANT",
      "content": [
        {
          "type": "text",
          "content": "……你好。有什么事吗，老师？"
        }
      ],
      "createdAt": "2026-01-15T08:31:05Z"
    }
  ],
  "total": 2,
  "page": 1,
  "limit": 20,
  "totalPages": 1,
  "hasNext": false,
  "hasPrevious": false
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 删除消息

::endpoint{method="DELETE" path="/chats/{chatId}/messages/{messageId}" auth}
删除指定会话中的指定消息。
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 204 | 删除消息成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 获取会话配置

::endpoint{method="GET" path="/chats/{chatId}/config" auth}
获取指定会话的 LLM 配置参数，需要是会话的所有者。
::

**响应数据：**

```json
{
  "temperature": 0.7,
  "maxTokens": 2048,
  "topP": 0.9,
  "systemPrompt": null
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 更新会话配置

::endpoint{method="PUT" path="/chats/{chatId}/config" auth}
更新指定会话的 LLM 配置参数，需要是会话的所有者。
::

**请求参数：**

::field{name="temperature" type="number"}
温度参数 (0-2)，控制随机性
::

::field{name="maxTokens" type="integer"}
最大生成 token 数
::

::field{name="topP" type="number"}
Top-P 采样参数 (0-1)
::

::field{name="systemPrompt" type="string"}
系统提示词
::

**响应数据：**

```json
{
  "temperature": 0.7,
  "maxTokens": 2048,
  "topP": 0.9,
  "systemPrompt": null
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 更新成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 获取插件订阅列表

::endpoint{method="GET" path="/chats/{chatId}/plugins" auth}
获取指定会话的所有插件订阅，需要是会话的所有者。
::

**响应数据：**

```json
[
  {
    "id": "e5f6a7b8-c9d0-1234-ef01-345678901234",
    "pluginId": "f6a7b8c9-d0e1-2345-f012-456789012345",
    "enabled": true,
    "config": {}
  }
]
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话不存在 |

---

## 启用/禁用插件

::endpoint{method="PUT" path="/chats/{chatId}/plugins/{pluginId}" auth}
为指定会话启用或禁用一个插件，如果订阅不存在则自动创建。
::

**请求参数：**

::field{name="enabled" type="boolean" required}
是否启用
::

**响应数据：**

```json
{
  "id": "e5f6a7b8-c9d0-1234-ef01-345678901234",
  "pluginId": "f6a7b8c9-d0e1-2345-f012-456789012345",
  "enabled": true,
  "config": {}
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 操作成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话或插件不存在 |

---

## 更新插件配置

::endpoint{method="PUT" path="/chats/{chatId}/plugins/{pluginId}/config" auth}
更新指定会话中某个插件的配置参数，插件订阅必须已存在。
::

**请求参数：**

::field{name="config" type="object" required}
插件配置（JSON 对象）
::

**响应数据：**

```json
{
  "id": "e5f6a7b8-c9d0-1234-ef01-345678901234",
  "pluginId": "f6a7b8c9-d0e1-2345-f012-456789012345",
  "enabled": true,
  "config": {
    "key": "value"
  }
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 更新成功 |
| 401 | 未登录或令牌无效 |
| 403 | 权限不足 |
| 404 | 会话或插件订阅不存在 |
