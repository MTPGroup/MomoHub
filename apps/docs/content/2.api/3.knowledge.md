---
title: 知识库
description: 知识库管理 API
navigation:
  icon: i-lucide-book-open
---

## 获取公开知识库列表

::endpoint{method="GET" path="/knowledge-bases/public"}
获取所有公开的知识库列表，支持分页。
::

**查询参数：**

::field{name="page" type="string"}
页码，从 1 开始
::

::field{name="limit" type="string"}
每页数量
::

**响应数据：**

```json
{
  "items": [
    {
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "白洲梓角色资料",
      "description": "碧蓝档案中白洲梓的背景故事、性格特征与对话风格参考",
      "authorId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
      "isPublic": true,
      "createdAt": "2026-01-01T00:00:00Z",
      "updatedAt": "2026-01-15T08:30:00Z"
    }
  ],
  "total": 10,
  "page": 1,
  "limit": 20,
  "totalPages": 1,
  "hasNext": false,
  "hasPrevious": false
}
```

---

## 搜索公开知识库

::endpoint{method="GET" path="/knowledge-bases/search"}
根据关键词搜索知识库名称和描述，支持分页。
::

**查询参数：**

::field{name="q" type="string"}
搜索关键词
::

::field{name="page" type="string"}
页码，从 1 开始
::

::field{name="limit" type="string"}
每页数量
::

**响应数据：**

```json
{
  "items": [
    {
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "白洲梓角色资料",
      "description": "碧蓝档案中白洲梓的背景故事、性格特征与对话风格参考",
      "authorId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
      "isPublic": true,
      "createdAt": "2026-01-01T00:00:00Z",
      "updatedAt": "2026-01-15T08:30:00Z"
    }
  ],
  "total": 3,
  "page": 1,
  "limit": 20,
  "totalPages": 1,
  "hasNext": false,
  "hasPrevious": false
}
```

---

## 获取我的知识库列表

::endpoint{method="GET" path="/knowledge-bases" auth}
获取当前用户创建的所有知识库列表，支持分页。
::

**查询参数：**

::field{name="page" type="string"}
页码，从 1 开始
::

::field{name="limit" type="string"}
每页数量
::

**响应数据：**

```json
{
  "items": [
    {
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "白洲梓角色资料",
      "description": "碧蓝档案中白洲梓的背景故事、性格特征与对话风格参考",
      "authorId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
      "isPublic": true,
      "createdAt": "2026-01-01T00:00:00Z",
      "updatedAt": "2026-01-15T08:30:00Z"
    }
  ],
  "total": 5,
  "page": 1,
  "limit": 20,
  "totalPages": 1,
  "hasNext": false,
  "hasPrevious": false
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |

---

## 获取知识库详情

::endpoint{method="GET" path="/knowledge-bases/{knowledgeBaseId}"}
获取指定知识库的详细信息。公开知识库无需认证，私有知识库需要是所有者。
::

**响应数据：**

```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "name": "白洲梓角色资料",
  "description": "碧蓝档案中白洲梓的背景故事、性格特征与对话风格参考",
  "authorId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
  "isPublic": true,
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-15T08:30:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 403 | 无权访问该知识库 |
| 404 | 知识库不存在 |

---

## 创建知识库

::endpoint{method="POST" path="/knowledge-bases" auth}
创建新的知识库，初始为空。
::

**请求参数：**

::field{name="name" type="string" required}
知识库名称
::

::field{name="description" type="string"}
知识库描述
::

::field{name="isPublic" type="boolean"}
是否公开，默认 `false`
::

**响应数据：**

```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "name": "白洲梓角色资料",
  "description": "碧蓝档案中白洲梓的背景故事、性格特征与对话风格参考",
  "authorId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
  "isPublic": false,
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:00:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 201 | 创建成功 |
| 400 | 输入参数无效 |
| 401 | 未登录或令牌无效 |

---

## 更新知识库

::endpoint{method="PUT" path="/knowledge-bases/{knowledgeBaseId}" auth}
更新指定知识库的名称、描述或公开状态。
::

**请求参数：**

::field{name="name" type="string" required}
知识库名称
::

::field{name="description" type="string"}
知识库描述
::

::field{name="isPublic" type="boolean" required}
是否公开
::

**响应数据：**

```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "name": "白洲梓角色资料",
  "description": "碧蓝档案中白洲梓的背景故事、性格特征与对话风格参考（已更新）",
  "authorId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
  "isPublic": true,
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-20T10:00:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 更新成功 |
| 400 | 输入参数无效 |
| 401 | 未登录或令牌无效 |
| 403 | 无权修改该知识库 |
| 404 | 知识库不存在 |

---

## 删除知识库

::endpoint{method="DELETE" path="/knowledge-bases/{knowledgeBaseId}" auth}
删除指定知识库及其所有关联文件和文档。此操作不可撤销。
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 204 | 删除成功 |
| 401 | 未登录或令牌无效 |
| 403 | 无权删除该知识库 |
| 404 | 知识库不存在 |

---

## 获取知识库统计

::endpoint{method="GET" path="/knowledge-bases/{knowledgeBaseId}/stats"}
获取知识库的文件数量和文档数量统计。公开知识库无需认证，私有知识库需要是所有者。
::

**响应数据：**

```json
{
  "knowledgeBaseId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "fileCount": 15,
  "documentCount": 230
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 403 | 无权访问该知识库 |
| 404 | 知识库不存在 |

---

## 获取知识库文件列表

::endpoint{method="GET" path="/knowledge-bases/{knowledgeBaseId}/files"}
获取指定知识库中的所有文件列表。公开知识库无需认证，私有知识库需要是所有者。
::

**响应数据：**

```json
[
  {
    "id": "f1a2b3c4-d5e6-7890-abcd-ef1234567890",
    "knowledgeBaseId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "fileName": "白洲梓角色设定.pdf",
    "fileSize": 2048576,
    "fileType": "application/pdf",
    "status": "COMPLETED",
    "errorMessage": null,
    "createdAt": "2026-01-01T00:00:00Z",
    "updatedAt": "2026-01-01T00:05:00Z"
  }
]
```

文件处理状态：`PENDING` | `PROCESSING` | `COMPLETED` | `FAILED`

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 403 | 无权访问该知识库 |
| 404 | 知识库不存在 |

---

## 获取文件详情

::endpoint{method="GET" path="/knowledge-bases/{knowledgeBaseId}/files/{fileId}" auth}
获取指定文件的详细信息。
::

**响应数据：**

```json
{
  "id": "f1a2b3c4-d5e6-7890-abcd-ef1234567890",
  "knowledgeBaseId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "fileName": "白洲梓角色设定.pdf",
  "fileSize": 2048576,
  "fileType": "application/pdf",
  "status": "COMPLETED",
  "errorMessage": null,
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:05:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |
| 403 | 无权访问该文件 |
| 404 | 文件不存在 |

---

## 上传文件

::endpoint{method="POST" path="/knowledge-bases/{knowledgeBaseId}/files" auth}
通过 `multipart/form-data` 上传文件到指定知识库，文件将被解析并向量化。支持 PDF、DOCX、TXT 等格式。
::

**请求参数：**

::field{name="file" type="binary" required}
文件内容
::

```bash
curl -X POST https://azusa.hanasaki.tech/v1/knowledge-bases/a1b2c3d4-e5f6-7890-abcd-ef1234567890/files \
  -H "Authorization: Bearer <token>" \
  -F "file=@碧蓝档案世界观.pdf"
```

**响应数据：**

```json
{
  "id": "f1a2b3c4-d5e6-7890-abcd-ef1234567890",
  "knowledgeBaseId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "fileName": "碧蓝档案世界观.pdf",
  "fileSize": 1048576,
  "fileType": "application/pdf",
  "status": "PENDING",
  "errorMessage": null,
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-01T00:00:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 上传成功 |
| 400 | 输入参数无效或未上传文件 |
| 401 | 未登录或令牌无效 |
| 403 | 无权修改该知识库 |
| 404 | 知识库不存在 |

---

## 删除文件

::endpoint{method="DELETE" path="/knowledge-bases/{knowledgeBaseId}/files/{fileId}" auth}
删除指定文件及其关联的所有文档片段。
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 204 | 删除成功 |
| 401 | 未登录或令牌无效 |
| 403 | 无权删除该文件 |
| 404 | 文件不存在 |

---

## 重试失败的文件

::endpoint{method="POST" path="/knowledge-bases/{knowledgeBaseId}/files/{fileId}/retry" auth}
重新处理状态为失败的文件。
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 已加入重试队列 |
| 400 | 文件状态不是失败 |
| 401 | 未登录或令牌无效 |
| 403 | 无权操作该文件 |
| 404 | 文件不存在 |

---

## 搜索指定知识库

::endpoint{method="POST" path="/knowledge-bases/{knowledgeBaseId}/search" auth}
在指定知识库中进行向量相似度搜索。
::

**请求参数：**

::field{name="query" type="string" required}
搜索查询文本
::

::field{name="threshold" type="number"}
相似度阈值
::

::field{name="limit" type="integer"}
返回结果数量
::

**响应数据：**

```json
[
  {
    "documentId": "d1e2f3a4-b5c6-7890-abcd-ef1234567890",
    "knowledgeBaseId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "content": "白洲梓是千禧年科学学园的学生，隶属于研讨会，性格冷静而理性...",
    "metadata": {},
    "similarity": 0.92
  }
]
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 搜索成功 |
| 401 | 未登录或令牌无效 |
| 403 | 无权访问该知识库 |
| 404 | 知识库不存在 |

---

## 搜索我的所有知识库

::endpoint{method="POST" path="/knowledge/search" auth}
在用户的所有知识库或指定的多个知识库中进行向量相似度搜索。
::

**请求参数：**

::field{name="query" type="string" required}
搜索查询文本
::

::field{name="knowledgeBaseIds" type="string[]"}
指定要搜索的知识库 ID 列表，不传则搜索所有
::

::field{name="threshold" type="number"}
相似度阈值
::

::field{name="limit" type="integer"}
返回结果数量
::

**响应数据：**

```json
[
  {
    "documentId": "d1e2f3a4-b5c6-7890-abcd-ef1234567890",
    "knowledgeBaseId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "content": "白洲梓是千禧年科学学园的学生，隶属于研讨会，性格冷静而理性...",
    "metadata": {},
    "similarity": 0.92
  }
]
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 搜索成功 |
| 401 | 未登录或令牌无效 |
| 403 | 无权访问指定的知识库 |

---

## 搜索公开知识库

::endpoint{method="POST" path="/knowledge/search/public"}
在所有公开的知识库中进行向量相似度搜索。
::

**请求参数：**

::field{name="query" type="string" required}
搜索查询文本
::

::field{name="knowledgeBaseIds" type="string[]"}
指定要搜索的公开知识库 ID 列表，不传则搜索所有公开知识库
::

::field{name="threshold" type="number"}
相似度阈值
::

::field{name="limit" type="integer"}
返回结果数量
::

**响应数据：**

```json
[
  {
    "documentId": "d1e2f3a4-b5c6-7890-abcd-ef1234567890",
    "knowledgeBaseId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "content": "三一补课部的冰魔女。自从从原本的学校退学后……",
    "metadata": {},
    "similarity": 0.88
  }
]
```
