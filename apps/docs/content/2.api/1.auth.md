---
title: 用户认证
description: 用户认证相关 API
navigation:
  icon: i-lucide-key-round
---

## 注册

::endpoint{method="POST" path="/auth/sign-up/email"}
使用邮箱、密码和用户名注册新用户。
::

**请求参数：**

::field{name="email" type="string" required}
用户邮箱地址
::

::field{name="name" type="string" required}
用户名
::

::field{name="password" type="string" required}
用户密码
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 201 | 注册成功 |
| 400 | 输入参数无效（如邮箱格式错误、密码太短等） |
| 409 | 邮箱已被注册 |

---

## 邮箱登录

::endpoint{method="POST" path="/auth/sign-in/email"}
使用邮箱和密码登录，获取访问令牌和刷新令牌。
::

**请求参数：**

::field{name="email" type="string" required}
用户邮箱地址
::

::field{name="password" type="string" required}
用户密码
::

**响应数据：**

```json
{
  "user": {
    "userId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
    "email": "user@example.com",
    "username": "Alice",
    "avatar": null,
    "isEmailVerified": true,
    "createdAt": "2026-01-01T00:00:00Z",
    "updatedAt": "2026-01-01T00:00:00Z"
  },
  "tokens": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "accessTokenExpiredIn": 1771325631,
    "refreshTokenExpiredIn": 1771930431,
    "tokenType": "Bearer"
  }
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 登录成功 |
| 400 | 输入参数无效 |
| 401 | 用户名或密码错误 |

---

## 刷新 Token

::endpoint{method="POST" path="/auth/refresh"}
使用刷新令牌获取新的访问令牌。
::

**请求参数：**

::field{name="refreshToken" type="string" required}
当前有效的 Refresh Token
::

**响应数据：**

```json
{
  "user": {
    "userId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
    "email": "user@example.com",
    "username": "Alice",
    "avatar": null,
    "isEmailVerified": true,
    "createdAt": "2026-01-01T00:00:00Z",
    "updatedAt": "2026-01-01T00:00:00Z"
  },
  "tokens": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
    "accessTokenExpiredIn": 1771325631,
    "refreshTokenExpiredIn": 1771930431,
    "tokenType": "Bearer"
  }
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 刷新成功 |
| 401 | 刷新令牌无效或已过期 |

---

## 退出登录

::endpoint{method="POST" path="/auth/sign-out"}
注销当前会话，使刷新令牌失效。
::

**请求参数：**

::field{name="refreshToken" type="string" required}
需要注销的 Refresh Token
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 204 | 退出成功 |

---

## 发送 OTP

::endpoint{method="POST" path="/auth/email-otp/send"}
向指定邮箱发送验证码，用于验证邮箱或重置密码。
::

**请求参数：**

::field{name="email" type="string" required}
目标邮箱地址
::

::field{name="type" type="string" required}
OTP 类型：`reset_password`、`verify_email`、`sign_in`
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 验证码发送成功 |
| 400 | 邮箱格式错误或类型不支持 |

---

## 验证邮箱

::endpoint{method="POST" path="/auth/email-otp/verify-email"}
使用收到的验证码验证用户邮箱。
::

**请求参数：**

::field{name="email" type="string" required}
用户邮箱地址
::

::field{name="otp" type="string" required}
收到的验证码
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 邮箱验证成功 |
| 400 | 验证码错误或已过期 |

---

## 重置密码

::endpoint{method="POST" path="/auth/email-otp/reset-password"}
使用验证码重置用户密码。
::

**请求参数：**

::field{name="email" type="string" required}
用户邮箱地址
::

::field{name="otp" type="string" required}
验证码
::

::field{name="password" type="string" required}
新密码
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 密码重置成功 |
| 400 | 验证码错误或密码格式不符 |

---

## 获取当前用户

::endpoint{method="GET" path="/auth/me" auth}
获取当前登录用户的详细信息。
::

**响应数据：**

```json
{
  "userId": "8ebc8550-6d4b-4dd0-967b-3e1367a4abf1",
  "email": "user@example.com",
  "username": "Alice",
  "avatar": null,
  "isEmailVerified": true,
  "createdAt": "2026-01-01T00:00:00Z",
  "updatedAt": "2026-01-15T08:30:00Z"
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 获取成功 |
| 401 | 未登录或令牌无效 |

---

## 更新个人信息

::endpoint{method="PUT" path="/auth/me" auth}
更新当前登录用户的用户名。
::

**请求参数：**

::field{name="username" type="string" required}
新的用户名
::

::field{name="avatar" type="string" }
新的头像 URL
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 更新成功 |
| 401 | 未登录或令牌无效 |

---

## 上传头像

::endpoint{method="PUT" path="/auth/me/avatar" auth}
上传或更新用户头像。使用 `multipart/form-data` 格式。
::

**请求参数：**

::field{name="file" type="binary" required}
头像图片文件
::

**响应数据：**

```json
{
  "avatar": "https://cdn-momohub.hanasaki.tech/avatars/8ebc8550-6d4b-4dd0-967b-3e1367a4abf1.jpg",
}
```

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 上传成功 |
| 400 | 未上传文件或文件格式无效 |
| 401 | 未登录或令牌无效 |

---

## 修改密码

::endpoint{method="POST" path="/auth/password/change" auth}
已登录用户修改自己的密码。
::

**请求参数：**

::field{name="oldPassword" type="string" required}
当前密码
::

::field{name="newPassword" type="string" required}
新密码
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 200 | 密码修改成功 |
| 400 | 新密码格式不符 |
| 401 | 旧密码错误或未登录 |

---

## 注销账号

::endpoint{method="DELETE" path="/auth/account" auth}
永久删除当前用户账号。
::

**响应状态码：**

| 状态码 | 说明 |
| --- | --- |
| 204 | 账号已删除 |
| 401 | 未登录 |
